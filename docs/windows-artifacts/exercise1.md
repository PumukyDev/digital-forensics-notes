# Exercise

## Main objectives of the practice
- Analyze the evidence provided by different artifacts in Windows operating systems.

---

## PART A

### 1. Regarding *prefetch*

- **What are they?**  
These are files generated by Windows that contain data about executed programs.

- **What file extension do they have?**  
.pf

- **In which directory can they be found?**  
The default path for prefetch files is `C:\Windows\Prefetch`.

- **What forensic information do they store that may be important for an investigation?**  
They allow reconstruction of user activity, showing a chronology of executed programs and sometimes how many times they were run.

### 2. Regarding *LOGs*

- **Which ones do you think are the most important based on the content they store?**  
Application logs are the most important for forensic analysis, as they show user actions. In enterprise environments, system logs are also crucial to check for damage caused by malware.

- **Where can they be found?**  
System logs are located at `C:\Windows\System32\winevt\Logs`.  
*These logs record security events, system events, and application events.*

### 3. Regarding the hibernation file `hiberfil.sys`

- **Where can it be found?**  
The typical location is the root of the disk: `C:\`.

- **Which tool can be used to decode its contents?**  
Rekall, Volatility, or WinDbg (Microsoft Windows Debugger), among others.

- **Do you think the information it contains is important?**  
Yes, it contains a snapshot of RAM when the system enters hibernation, potentially holding sensitive user data and system state.

### 4. Regarding snapshots, restore points and/or Volume Shadow Copies Service (VSS)

- **What file system is required to use this technology?**  
NTFS

- **Is it enabled by default or does the user need to activate it?**  
It is enabled by default, but periodic snapshots are not configured automatically.

- **How often are they created?**  
They are typically created during major installations or updates.

- **Think of a couple of scenarios where they may be useful:**  
1. Recovering the system after a ransomware attack.  
2. Undoing changes caused by faulty driver updates.

### 5. Questions related to the Windows Registry

- **Research how to import and export registry keys in CLI and GUI environments:**  
a) GUI: Open Regedit → select key → File → Export / Import  
![alt text](image.png)  
b) CLI:  
reg export "(Key)" C:\(Name_to_export)  
reg import C:\(Name_of_the_key_to_import)  

- **List registry keys that are forensically interesting to export and analyze, explaining what information they reveal:**  
`Run`: Programs executed at startup.  
`RecentDocs`: Recently opened files.  
`USBStor`: USB devices connected to the system.

### 6. Events of forensic interest

- **What types of events may be interesting to inspect from a forensic perspective? Give a couple of examples:**  
Security events: Track user logins.  
System events: Track software installations and failures.

### 7. Software tools
**Tools for each artifact:**  
- **Prefetch:** [PECmd](https://github.com/EricZimmerman/PECmd)  
- **Logs:** [Event Log Explorer](https://www.eventlogxp.com/)  
- **Hibernation file:** [Volatility](https://volatilityfoundation.org/)  
- **Volume Shadow Copies Service:** [ShadowExplorer](https://www.shadowexplorer.com/downloads.html)  
- **System registry:** [FTK Imager](https://www.exterro.com/digital-forensics-software/ftk-imager)  
- **Event management:** [Event Log Explorer](https://www.eventlogxp.com/)  
- **Shortcuts & Caches and browsing history:** [Nirsoft](https://www.nirsoft.net/web_browser_tools.html)  
- **Recycle Bin:** [Rifiuti](https://abelcheung.github.io/rifiuti2/)

---

## PART B

The practice consists of extracting as much evidence as possible from a Windows operating system by performing targeted searches on the different artifacts it uses.

Although in a real scenario this would be done using a system image, for this practice it is recommended, for agility, to use the operating system installed on the student’s computer.

### Software to be used
- **A.** Windows 10 (32 or 64 bits)  
- **B.** FTK Imager  
- **C.** Arsenal Image Mounter  
- **D.** Registry Explorer  
- **E.** Reg Ripper  
- **F.** WRR  
- **G.** LinkParser  
- **H.** JumpListExplorer  
- **I.** ShellbagExplorer  
- **J.** USB Detective

### Evidence extraction

Open FTK Imager and click the image icon.  
![alt text](image-1.png)  
*This will allow you to mount the disk image for analysis.*

Click "Logical Drive".  
![alt text](image-2.png)  

Select your disk and click "Finish".  
![alt text](image-3.png)  

Verify the evidence tree appears in FTK Imager.  
![alt text](image-4.png)  

Now extract some files for analysis by navigating to `\root\Windows\System32\Config\` and clicking "Export Files..."  
![alt text](image-5.png)  
*These are critical registry hives for forensic analysis.*

I’ll save them as "windows-artifacts".  
![alt text](image-6.png)  

Open WRR, click "Open" → "File".  
![alt text](image-8.png)  

Select "SOFTWARE", "SYSTEM" and "SAM".  
![alt text](image-9.png)  
*These registry hives contain software settings, system info, and user account data.*

Verify files were correctly exported to WRR.  
![alt text](image-10.png)  

Do the same for `root\Windows\Users\{USER}`.  
![alt text](image-26.png)  

Add "NTUSER.DAT" to WRR.  
![alt text](image-78.png)  
*This contains user-specific settings and activity.*

---

### Artifacts and paths of interest

#### System information
- **System version**  
`Software\Microsoft\Windows NT\CurrentVersion`  
*Shows OS version, build, and install info.*  
![alt text](image-11.png)

- **Machine name**  
`System\ControlSet001\Control\ComputerName\ComputerName`  
*Stores the hostname of the computer.*  
![alt text](image-13.png)

- **Time zone**  
`System\ControlSet001\Control\TimeZoneInformation`  
*Shows local time zone settings.*  
![alt text](image-12.png)

- **Last access timestamp**  
`System\ControlSet001\Control\Filesystem`  
*Tracks last access times of files.*

- **Shutdown time**  
`System\ControlSet001\Control\Windows`  
*Stores last shutdown or restart timestamps.*  
![alt text](image-14.png)  
![alt text](image-15.png)

#### Network
- **Network interfaces**  
`System\ControlSet001\Services\Tcpip\Parameters\Interfaces\{GUID_INTERFACE}`  
*Shows IP addresses, MACs, and interface configurations.*  
![alt text](image-16.png)  
![alt text](image-17.png)

- **Network history**  
`Software\Microsoft\Windows NT\CurrentVersion\NetworkList\`  
*Contains networks the computer connected to, including SSIDs.*  
![alt text](image-20.png)  
![alt text](image-19.png)  
![alt text](image-18.png)

`Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Nla\Cache`  
`Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Nla\Wireless`  
*Cached information about wireless networks.*  
![alt text](image-22.png)  
![alt text](image-21.png)

- **When a network was connected**  
`Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles`  
*Shows timestamps of network connections.*  
![alt text](image-24.png)  
![alt text](image-23.png)

#### Sharing and startup
- **Shared folders**  
`System\ControlSet001\Services\LanmanServer\Shares\`  
*Lists folders shared over the network.*  
![alt text](image-25.png)

- **Startup programs**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run`  
*Programs set to start automatically when the user logs in.*  
![alt text](image-27.png)

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce`  
*Programs that run once on next login.*  
![alt text](image-28.png)

`Software\Microsoft\Windows\CurrentVersion\RunOnce`  
![alt text](image-29.png)

`Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run`  
*Sometimes contains enforced startup items.*  
(Doesn’t exist in my case.)

`Software\Microsoft\Windows\CurrentVersion\Run`  
![alt text](image-30.png)

#### User activity
- **Searches in the search bar**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery`  
*(Not present on this system.)*

- **Typed paths in Start or Explorer**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths`  
*Shows file paths the user manually entered.*  
![alt text](image-31.png)

- **Recent documents**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs`  
*Tracks recently opened files.*  
![alt text](image-33.png)  
![alt text](image-32.png)

- **Recent Office documents**  
`NTUSER.DAT\Software\Microsoft\Office\{Version}\{Excel|Word}\UserMRU`  
(Not present.)

- **Reading position of last opened document**  
`NTUSER.DAT\Software\Microsoft\Office\Word\Reading Locations\Document X`  
(Not present.)

- **Autosaved Office files**  
`C:\Users\{user}\AppData\Roaming\Microsoft\{Excel|Word|PowerPoint}\`  
(Not present.)

- **OpenSaveMRU**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidlMRU`  
*Stores recently opened/saved files per application.*  
![alt text](image-34.png)

- **Last executed commands**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU`  
![alt text](image-35.png)

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\Policies\RunMRU`  
(Not present.)

- **UserAssist (programs executed)**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{GUID}\Count`  
*Tracks execution counts of applications.*  
![alt text](image-36.png)

- **Taskbar-related events**  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\FeatureUsage`  
*Tracks user interaction with taskbar features.*  
![alt text](image-37.png)  
`...\AppBadgeUpdated`  
![alt text](image-38.png)  
`...\AppLaunch`  
![alt text](image-39.png)  
`...\AppSwitched`  
![alt text](image-40.png)  
`...\ShowJumpView`  
![alt text](image-41.png)

- **Recent applications**  
`Software\Microsoft\Windows\CurrentVersion\Search\RecentApps`  
(Not present.)

#### Shortcuts and Jump Lists
- **Recent documents (LinkParser / LeCMD)**  
`C:\Users\{user}\AppData\Roaming\Microsoft\Windows\Recent`  
*Contains shortcut (.lnk) files of recently opened documents.*  
![alt text](image-43.png)  
![alt text](image-42.png)

- **Jump Lists**  
`AutomaticDestinations` and `CustomDestinations`  
`C:\Users\{user}\AppData\Roaming\Microsoft\Windows\Recent\`  
*Shows recent and pinned items for applications.*  
![alt text](image-44.png)  
![alt text](image-45.png)  
![alt text](image-46.png)  
![alt text](image-47.png)  
![alt text](image-48.png)  
![alt text](image-49.png)

#### Shellbags
![alt text](image-50.png)  
`USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags`  
`USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU`  
`NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU`  
*Tracks folder browsing activity and structure.*  
(Not present in my case.)

#### USB and MTP devices
- **MTP devices**  
`C:\Users\{user}\AppData\Local\Temp\WPDNSE\{GUID}`  
(Not present.)

- **USB storage (VID / PID)**  
`SYSTEM\ControlSet001\Enum\USBSTOR`  
*Shows vendor/product IDs and device serials.*  
![alt text](image-51.png)

- **USB volume names**  
`SOFTWARE\Microsoft\Windows Portable Devices\Devices`  
*Stores friendly device names.*  
![alt text](image-52.png)

- **User who used the USB device**  
`SYSTEM\MountedDevices`  
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\MountPoints2`  
*Shows which user mounted the device and assigned drive letters.*  
![alt text](image-53.png)  
![alt text](image-54.png)

- **Logical volume serial number**  
`Software\Microsoft\Windows NT\CurrentVersion\EMDMgmt`  
*Stores volume serials for identification.*  
![alt text](image-55.png)

- **First and last connection time**  
`SYSTEM\ControlSet001\Enum\USBSTOR\{VEN_PROD_VERSION}\{USB_SERIAL}\Properties\{83da6326-97a6-4088-9453-a1923f573b29}`  
`C:\Windows\inf\setupapi.dev.log`  
*Tracks timestamps of USB device connections.*  
(TBD)

#### Databases and system artifacts
- **Cortana database (older versions)**  
`C:\Users\{user}\AppData\Local\Packages\Microsoft.Windows.Cortana_xxxx\LocalState\ESEDatabase_CortanaCoreInstance\CortanaCoreDb.dat`  
(Not present.)

- **Windows notifications**  
`C:\Users\{user}\AppData\Local\Microsoft\Windows\Notifications\wpndatabase.db`  
*Tracks notifications shown to the user.*  
![alt text](image-57.png)  
![alt text](image-58.png)  
![alt text](image-59.png)  
![alt text](image-60.png)

- **Timeline**  
`C:\Users\{user}\AppData\Local\ConnectedDevicesPlatform\ActivitiesCache.db`  
*Tracks app and file activity over time.*  
![alt text](image-61.png)

- **Windows Store**  
`C:\Users\{user}\ProgramData\Microsoft\Windows\AppRepository\StateRepositoryDeployment.srd`  
*Contains Windows Store app installation state.*  
(Not accessible.)

#### Other artifacts
- **Thumbnails and Thumbcache**  
`thumbs.db`  
`C:\Users\{user}\AppData\Local\Microsoft\Windows\Explorer`  
*Stores thumbnail images of files for faster previews.*  
![alt text](image-62.png)  
![alt text](image-63.png)  
![alt text](image-64.png)  
![alt text](image-65.png)  
![alt text](image-66.png)

- **Recycle Bin**  
`C:\$Recycle.Bin`  
*Stores deleted files.*  
![alt text](image-68.png)

Copy for analysis:  
Copy-Item -Recurse -Force 'C:\$Recycle.Bin\S-1-5-21-4071608857-1089510339-248207473-1000' 'C:\RecycleBackup'  
![alt text](image-69.png)

Export to CSV:  
.\rifiuti-vista.exe -t "," -o "recycle-bin.csv" "C:\RecycleBackup"  
![alt text](image-67.png)

- **OfficeFileCache**  
`C:\Users\{user}\AppData\Local\Microsoft\Office\{Version}\OfficeFileCache`  
(Not present.)

- **OfficeBackstage**  
`C:\Users\{user}\AppData\Local\Microsoft\Office\16.0\BackstageInAppNavCache`  
(Not present.)

- **Public IP (ETLParser)**  
`C:\Windows\ServiceProfiles\NetworkService\AppData\Local\Microsoft\Windows\DeliveryOptimization\Logs`  

.\ETLParser.exe -c DeliveryLogs -s "C:\Windows\ServiceProfiles\NetworkService\AppData\Local\Microsoft\Windows\DeliveryOptimization\Logs" -o "C:\Users\adrian\Downloads\ETLOutput"  
![alt text](image-71.png)  
![alt text](image-70.png)  
![alt text](image-72.png)

- **PowerShell command history**  
`C:\Users\{user}\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt`  
*Stores previously executed PowerShell commands.*  
![alt text](image-73.png)

- **Prefetch**  
`C:\Windows\Prefetch`  
*Stores data about program execution.*  
![alt text](image-74.png)  
![alt text](image-75.png)  
![alt text](image-76.png)  
![alt text](image-77.png)

- **SuperFetch**  
`C:\Windows\Prefetch\Ag*.db`  
*Caches frequently used applications to speed up loading.*  
(TBD)

- **SRUM**  
`C:\Windows\System32\sru\SRUDB.dat`  
*Tracks network, CPU, and power usage.*

- **ShimCache**  
`SYSTEM\CurrentControlSet\Control\SessionManager\AppCompatCache\AppCompatCache`  
*Lists executed